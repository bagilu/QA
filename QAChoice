<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é¸æ“‡é¡Œæ¸¬é©—</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    .btn-answer { margin: 10px 0; }
    #result { font-weight: bold; margin-top: 15px; }
  </style>
</head>
<body class="container py-5">
  <h1 class="mb-4">é¸æ“‡é¡Œæ¸¬é©—</h1>
  <div id="question" class="mb-4">è¼‰å…¥ä¸­...</div>
  <div id="choices" class="d-grid gap-2"></div>
  <div id="result" class="mt-3"></div>

  <script>
    // ğŸ§© æ›¿æ›æˆä½ è‡ªå·±çš„ Supabase URL èˆ‡ API Key
    const supabaseUrl = 'https://jwqomxsavhoeljtrtnld.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3cW9teHNhdmhvZWxqdHJ0bmxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM0MDkyOTQsImV4cCI6MjA1ODk4NTI5NH0.JlFkZ6_jKzUWF-N_pp223W0eOOEQztxPA_bIGNzbL4A';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function loadRandomQuestion() {
      const questionDiv = document.getElementById('question');
      const choicesDiv = document.getElementById('choices');
      const resultDiv = document.getElementById('result');

      // å…ˆæ¸…ç©ºç•«é¢
      questionDiv.textContent = 'è¼‰å…¥ä¸­...';
      choicesDiv.innerHTML = '';
      resultDiv.textContent = '';

      // å¾ Supabase éš¨æ©ŸæŠ“ä¸€ç­†è³‡æ–™
      let { data, error } = await supabase
        .from('TblQuestionChoice')
        .select('*')
        .order('RANDOM()', { foreignTable: '', ascending: true })  // éš¨æ©Ÿæ’åº
        .limit(1);

      if (error) {
        questionDiv.textContent = 'âš ï¸ è¼‰å…¥é¡Œç›®å¤±æ•—';
        console.error(error);
        return;
      }

      const question = data[0];

      // é¡¯ç¤ºé¡Œç›®
      questionDiv.textContent = question.Q;

      // å»ºç«‹ç­”æ¡ˆé¸é …ä¸¦æ‰“äº‚
      const answers = [
        { text: question.CA, correct: true },
        { text: question.WA1, correct: false },
        { text: question.WA2, correct: false },
        { text: question.WA3, correct: false }
      ].sort(() => Math.random() - 0.5);

      // ç”¢ç”ŸæŒ‰éˆ•
      answers.forEach(answer => {
        const btn = document.createElement('button');
        btn.className = 'btn btn-outline-primary btn-answer';
        btn.textContent = answer.text;
        btn.onclick = () => {
          resultDiv.textContent = answer.correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤ï¼';
          btn.classList.remove('btn-outline-primary');
          btn.classList.add(answer.correct ? 'btn-success' : 'btn-danger');
        };
        choicesDiv.appendChild(btn);
      });
    }

    // è¼‰å…¥ä¸€é¡Œ
    loadRandomQuestion();
  </script>
</body>
</html>
